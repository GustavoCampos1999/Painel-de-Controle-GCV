<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Admin</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="calculadora.css">
</head>
<body>

    <div id="loading-overlay">
        <div class="loading-spinner"></div>
        <p>Carregando dados...</p>
    </div>

    <header>
        <div class="header-logo-container">
            <img src="images/logo.webp" alt="Logo Primor" id="header-logo">
            <h1>Painel de Controle</h1>
            <button id="btn-theme-toggle" class="theme-toggle-button" title="Mudar tema">üåô</button>
        </div>
        <div>
            <span id="user-email">Carregando...</span>
            <a href="#" id="btn-logout" style="margin-left: 15px;">Sair</a>
        </div>
    </header>

    

    <nav class="tabs">
        <button class="tab-button active" data-tab="tab-clientes">Clientes & Or√ßamentos</button>
        <button class="tab-button" data-tab="tab-gerenciar-dados">Gerenciar Dados</button>
    </nav>

    <main>
        <div id="tab-clientes" class="tab-content active">
            
            <div id="client-list-view">
                <div class="list-container">
                    <div class="list-header">
                        <h2>Meus Clientes</h2>
                        <button id="btn-abrir-modal-add" class="btn-adicionar">Adicionar Novo Cliente</button>
                    </div>
                    <input type="text" id="input-pesquisa" placeholder="Pesquisar por nome...">
                    <div id="lista-clientes">
                        </div>
                </div>
            </div>

            <div id="calculator-view" style="display: none;">
                <div class="calculator-header">
                     <button id="btn-voltar-clientes">&larr; Voltar para Clientes</button>
                     <h2 id="calculator-client-name">Calculadora para Cliente</h2>
                     <button id="btn-add-linha-calc" class="btn-adicionar" style="margin-left: 15px;">+ Ambiente</button>
                     <span id="save-status" class="save-status"></span>
                </div>

                <div class="tabela-container calculator-container">
                    <table id="tabela-calculo-cliente">
                       <thead>
                            <tr>
                                <th rowspan="2" class="col-acoes-calc">A√á√ïES</th>
                                <th rowspan="2" class="col-ambiente-calc">AMBIENTE</th>
                                <th colspan="2" class="sessao-medidas">MEDIDAS</th>
                                <th colspan="2" class="sessao-cortina">TECIDO CORTINA</th> <th colspan="1" class="sessao-forro">TECIDO FORRO</th>   <th colspan="2" class="sessao-blackout">BLACKOUT</th> <th colspan="5" class="sessao-valores">VALORES</th>
                                <th colspan="2" class="sessao-orcamento">OR√áAMENTO</th>
                            </tr>
                            <tr>
                                <th class="sessao-medidas">LARGURA</th>
                                <th class="sessao-medidas">ALTURA</th>
                                <th class="sessao-cortina">FRANZIDO</th>
                                <th class="sessao-cortina">C√ìDIGO TECIDO</th>
                                <th class="sessao-cortina">QTD.</th>
                                <th class="sessao-forro">C√ìDIGO TECIDO</th>
                                <th class="sessao-forro">QTD.</th>
                                <th class="sessao-blackout">FRANZIDO</th>
                                <th class="sessao-blackout">C√ìDIGO TECIDO</th>
                                <th class="sessao-blackout">QTD.</th>
                                <th class="sessao-valores">CONFEC√á√ÉO</th>
                                <th class="sessao-valores">TRILHO</th>
                                <th class="sessao-valores">INSTALA√á√ÉO</th>
                                <th class="sessao-valores">FRETE</th>
                                <th class="sessao-valores">OUTROS</th>
                                <th class="sessao-orcamento">√Ä VISTA</th>
                                <th id="th-parcelado-header" class="sessao-orcamento">D√âBITO</th>
                            </tr>
                        </thead>
                        <tbody id="corpo-tabela-calculo-cliente"></tbody>
                    </table>
                </div>
        <div class="wrapper-markups calculator-markups">
                   
                   <button id="btn-abrir-config-calculadora" class="btn-config-calc" title="Configura√ß√µes">&#9881;</button> 

                   <div class="grupo-markups">
                        <div>
                            <label for="select-parcelamento-global">PARCELAMENTO</label>
                            <select id="select-parcelamento-global" class="global-calc-trigger"></select>
                        </div>
                    </div>
                </div>
                <template id="template-linha-calculadora">
                     <tr class="linha-calculo-cliente">
                         <td class="col-acoes-calc"><button class="btn-remover-linha btn-excluir">√ó</button></td>
                         <td class="col-ambiente-calc"><input type="text" class="input-ambiente" placeholder="Ex: Sala"></td>
                         <td><input type="number" step="0.01" class="input-largura"></td>
                         <td><input type="number" step="0.01" class="input-altura"></td>
                         <td><select class="select-franzCortina"></select></td>
                         <td><select class="select-codTecidoCortina"></select></td>
                         <td><input type="text" class="resultado" readonly></td>
                         <td><select class="select-codTecidoForro"></select></td>
                         <td><input type="text" class="resultado" readonly></td>
                         <td><select class="select-franzBlackout"></select></td>
                         <td><select class="select-codTecidoBlackout"></select></td>
                         <td><input type="text" class="resultado" readonly></td>
                         <td><select class="select-confecao"></select></td>
                         <td><select class="select-trilho"></select></td>
                         <td><select class="select-instalacao"></select></td>
                         <td><select class="select-frete"></select></td>
                         <td><input type="text" class="input-outros"></td>
                         <td><input type="text" class="resultado-preco" readonly></td>
                         <td><input type="text" class="resultado-preco" readonly></td>
                     </tr>
                 </template>
            </div>
        </div>

        <div id="tab-gerenciar-dados" class="tab-content">
            
            <div class="gerenciar-dados-container">
                <nav class="sub-tabs">
                    <button class="subtab-button active" data-subtab="subtab-tecidos">Tecidos</button>
                    <button class="subtab-button" data-subtab="subtab-confeccao">Confec√ß√£o</button>
                    <button class="subtab-button" data-subtab="subtab-trilho">Trilho</button>
                </nav>

                <div id="subtab-tecidos" class="subtab-content active">
                    <section class="gerenciar-dados-secao">
                        <div class="secao-header">
                            <h2>Gerenciar Tecidos</h2>
                            <button id="btn-abrir-modal-add-tecido" class="btn-adicionar">Adicionar Tecido</button>
                        </div>
                        <input type="text" id="input-pesquisa-tecidos" class="input-pesquisa-dados" placeholder="Pesquisar por nome do tecido...">
                        <table id="tabela-tecidos">
                            <thead>
                                <tr>
                                    <th class="sortable-header" data-sort-key="produto">Produto <span class="sort-arrow"></span></th>
                                    <th class="sortable-header" data-sort-key="largura">Largura <span class="sort-arrow"></span></th>
                                    <th class="sortable-header" data-sort-key="atacado">Pre√ßo (Atacado) <span class="sort-arrow"></span></th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="tabela-tecidos-body">
                                </tbody>
                        </table>
                    </section>
                </div>

                <div id="subtab-confeccao" class="subtab-content">
                    <section class="gerenciar-dados-secao">
                        <div class="secao-header">
                            <h2>Gerenciar Tipos de Confec√ß√£o</h2>
                            <button id="btn-abrir-modal-add-confeccao" class="btn-adicionar">Adicionar Confec√ß√£o</button>
                        </div>
                        <input type="text" id="input-pesquisa-confeccao" class="input-pesquisa-dados" placeholder="Pesquisar por nome da op√ß√£o...">
                        <table id="tabela-confeccao">
                            <thead>
                                <tr>
                                    <th class="sortable-header" data-sort-key="opcao">Op√ß√£o <span class="sort-arrow"></span></th>
                                    <th class="sortable-header" data-sort-key="valor">Valor <span class="sort-arrow"></span></th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="tabela-confeccao-body">
                                </tbody>
                        </table>
                    </section>
                </div>

                <div id="subtab-trilho" class="subtab-content">
                     <section class="gerenciar-dados-secao">
                        <div class="secao-header">
                            <h2>Gerenciar Tipos de Trilho</h2>
                            <button id="btn-abrir-modal-add-trilho" class="btn-adicionar">Adicionar Trilho</button>
                        </div>
                        <input type="text" id="input-pesquisa-trilho" class="input-pesquisa-dados" placeholder="Pesquisar por nome da op√ß√£o...">
                        <table id="tabela-trilho">
                            <thead>
                                <tr>
                                    <th class="sortable-header" data-sort-key="opcao">Op√ß√£o <span class="sort-arrow"></span></th>
                                    <th class="sortable-header" data-sort-key="valor">Valor <span class="sort-arrow"></span></th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="tabela-trilho-body">
                                </tbody>
                        </table>
                    </section>
                </div>
            </div> </div> </main>

    <div id="toast-notification" class="toast"></div>

    <div id="modal-add-cliente" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2>Adicionar Novo Cliente</h2>
            <form id="form-add-cliente">
                <div><label for="add-nome">Nome:</label><input type="text" id="add-nome" name="nome" required></div>
                <div><label for="add-telefone">Telefone:</label><input type="text" id="add-telefone" name="telefone"></div>
                <div><label for="add-email">Email:</label><input type="email" id="add-email" name="email"></div>
                <div><label for="add-endereco">Endere√ßo:</label><input type="text" id="add-endereco" name="endereco"></div>
                <div class="modal-actions">
                    <button type="button" id="btn-cancelar-add" class="btn-cancelar">Cancelar</button>
                    <button type="submit" class="btn-salvar">Salvar</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="modal-editar-cliente" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2>Editar Cliente</h2>
            <form id="form-editar-cliente">
                <input type="hidden" id="edit-id" name="id">
                <div><label for="edit-nome">Nome:</label><input type="text" id="edit-nome" name="nome" required></div>
                <div><label for="edit-telefone">Telefone:</label><input type="text" id="edit-telefone" name="telefone"></div>
                <div><label for="edit-email">Email:</label><input type="email" id="edit-email" name="email"></div>
                <div><label for="edit-endereco">Endere√ßo:</label><input type="text" id="edit-endereco" name="endereco"></div>
                <div class="modal-actions">
                    <button type="button" id="btn-cancelar-editar" class="btn-cancelar">Cancelar</button>
                    <button type="submit" class="btn-salvar">Salvar Altera√ß√µes</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modal-confirm-excluir-cliente" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2>Confirmar Exclus√£o</h2>
            <p>Tem certeza que deseja excluir o cliente <strong id="cliente-nome-excluir"></strong>?</p>
            <div class="modal-actions">
                <button type="button" id="btn-cancelar-excluir-cliente" class="btn-cancelar">Cancelar</button>
                <button type="button" id="btn-confirmar-excluir-cliente" class="btn-excluir">Excluir</button>
            </div>
        </div>
    </div>

    <div id="modal-add-tecido" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2>Adicionar Tecido</h2>
            <form id="form-add-tecido">
                <div><label for="add-tecido-produto">Produto:</label><input type="text" id="add-tecido-produto" name="produto" required></div>
                <div><label for="add-tecido-largura">Largura:</label><input type="number" step="0.01" id="add-tecido-largura" name="largura"></div>
                <div><label for="add-tecido-atacado">Pre√ßo Atacado:</label><input type="number" step="0.01" id="add-tecido-atacado" name="atacado"></div>
                <div class="modal-actions">
                    <button type="button" id="btn-cancelar-add-tecido" class="btn-cancelar">Cancelar</button>
                    <button type="submit" class="btn-salvar">Salvar</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="modal-edit-tecido" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2>Editar Tecido</h2>
            <form id="form-edit-tecido">
                <input type="hidden" name="id">
                <div><label for="edit-tecido-produto">Produto:</label><input type="text" id="edit-tecido-produto" name="produto" required></div>
                <div><label for="edit-tecido-largura">Largura:</label><input type="number" step="0.01" id="edit-tecido-largura" name="largura"></div>
                <div><label for="edit-tecido-atacado">Pre√ßo Atacado:</label><input type="number" step="0.01" id="edit-tecido-atacado" name="atacado"></div>
                <div class="modal-actions">
                    <button type="button" id="btn-cancelar-edit-tecido" class="btn-cancelar">Cancelar</button>
                    <button type="submit" class="btn-salvar">Salvar Altera√ß√µes</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modal-add-confeccao" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2>Adicionar Op√ß√£o de Confec√ß√£o</h2>
            <form id="form-add-confeccao">
                <div><label for="add-confeccao-opcao">Op√ß√£o:</label><input type="text" id="add-confeccao-opcao" name="opcao" required></div>
                <div><label for="add-confeccao-valor">Valor:</label><input type="number" step="0.01" id="add-confeccao-valor" name="valor"></div>
                <div class="modal-actions">
                    <button type="button" id="btn-cancelar-add-confeccao" class="btn-cancelar">Cancelar</button>
                    <button type="submit" class.btn-salvar">Salvar</button>
                </div>
            </form>
        </div>
    </div>
    <div id="modal-edit-confeccao" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2>Editar Op√ß√£o de Confec√ß√£o</h2>
            <form id="form-edit-confeccao">
                <input type="hidden" name="id">
                <div><label for="edit-confeccao-opcao">Op√ß√£o:</label><input type="text" id="edit-confeccao-opcao" name="opcao" required></div>
                <div><label for="edit-confeccao-valor">Valor:</label><input type="number" step="0.01" id="edit-confeccao-valor" name="valor"></div>
                <div class="modal-actions">
                    <button type="button" id="btn-cancelar-edit-confeccao" class="btn-cancelar">Cancelar</button>
                    <button type="submit" class="btn-salvar">Salvar Altera√ß√µes</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modal-add-trilho" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2>Adicionar Op√ß√£o de Trilho</h2>
            <form id="form-add-trilho">
                <div><label for="add-trilho-opcao">Op√ß√£o:</label><input type="text" id="add-trilho-opcao" name="opcao" required></div>
                <div><label for="add-trilho-valor">Valor:</label><input type="number" step="0.01" id="add-trilho-valor" name="valor"></div>
                <div class="modal-actions">
                    <button type="button" id="btn-cancelar-add-trilho" class="btn-cancelar">Cancelar</button>
                    <button type="submit" class="btn-salvar">Salvar</button>
                </div>
            </form>
        </div>
    </div>
    <div id="modal-edit-trilho" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2>Editar Op√ß√£o de Trilho</h2>
            <form id="form-edit-trilho">
                <input type="hidden" name="id">
                <div><label for="edit-trilho-opcao">Op√ß√£o:</label><input type="text" id="edit-trilho-opcao" name="opcao" required></div>
                <div><label for="edit-trilho-valor">Valor:</label><input type="number" step="0.01" id="edit-trilho-valor" name="valor"></div>
                <div class="modal-actions">
                    <button type="button" id="btn-cancelar-edit-trilho" class="btn-cancelar">Cancelar</button>
                    <button type="submit" class="btn-salvar">Salvar Altera√ß√µes</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modal-confirm-excluir-generico" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2>Confirmar Exclus√£o</h2>
            <p>Tem certeza que deseja excluir <strong id="item-nome-excluir"></strong>?</p>
            <div class="modal-actions">
                <button type="button" id="btn-cancelar-excluir-generico" class="btn-cancelar">Cancelar</button>
                <button type="button" id="btn-confirmar-excluir-generico" class="btn-excluir">Excluir</button>
            </div>
        </div>
    </div>
    
    <div id="modal-confirm-excluir-linha" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2>Confirmar Exclus√£o</h2>
            <p>Tem certeza que deseja excluir o ambiente <strong id="ambiente-nome-excluir">este ambiente</strong>?</p>
            <div class="modal-actions">
                <button type="button" id="btn-cancelar-excluir-linha" class="btn-cancelar">Cancelar</button>
                <button type="button" id="btn-confirmar-excluir-linha" class="btn-excluir">Excluir</button>
            </div>
        </div>
    </div>

    <div id="modal-config-calculadora" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2>Configura√ß√µes do Or√ßamento</h2>
            
            <div class="config-calculadora-content">
                <p>Ajuste o valor base para o c√°lculo do or√ßamento.</p>
                
                <div class="grupo-markups-modal">
                    <div>
                        <label for="input-markup-base-calc">MARKUP (%)</label>
                        <input type="number" id="input-markup-base-calc" class="global-calc-trigger" value="100">
                    </div>
                </div>
            </div>

            <div class="modal-actions">
                <button type="button" id="btn-fechar-config-calculadora" class="btn-cancelar">Fechar</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script type="module" src="script.js"></script>
</body>
</html>